---
title: 微信聊天自动回复机器人代码
date: 2020-08-05
tags: [ robot, 微信自动回复, python ]
categories: python
top: 9
password: 

---

微信聊天自动回复小程序, 输入指定内容控制开关，以及添加附加内容等小功能,

<!-- more -->


# 完整代码
```
#!/usr/bin/python
# -*- coding: utf-8 -*-

import itchat
import re,requests
from urllib.parse import quote,unquote

AUTO_REPLAY=0
BASEMSG = ''

def robot(data):
    global AUTO_REPLAY
    ini="{'sessionId':'09e2aca4d0a541f88eecc77c03a8b393','robotId':'webbot','userId':'462d49d3742745bb98f7538c42f9f874','body':{'content':'" + data + "'},'type':'txt'}&ts=1529917589648"
    url = "http://i.xiaoi.com/robot/webrobot?&callback=__webrobot_processMsg&data=" + quote(ini)
    cookie = {"cnonce": "808116", "sig": "0c3021aa5552fe597bb55448b40ad2a90d2dead5","XISESSIONID": "hlbnd1oiwar01dfje825gavcn", "nonce": "273765", "hibext_instdsigdip2": "1"}
    r = requests.get(url, cookies=cookie)
    #print(type(r))
    #json_r = r.json()
    #print(json_r)
    pattern = re.compile(r'\"fontColor\":0,\"content\":\"(.*?)\"')
    result = pattern.findall(r.text)
        #return result[1].replace("\\r\\n",'')
        #return result[1].replace("\\n",'')
    return result[1].replace("\\r\\n",'')

import re,requests
try:
    from urllib import quote,unquote
except ImportError:
    from urllib.parse import quote,unquote

import json


def qingke_robot(msg):
    #ssl._create_default_https_context = ssl._create_unverified_context
    url = r"http://api.qingyunke.com/api.php?key=free&appid=0&msg=%s" % (quote(msg))

    try:
            from urllib.request import urlopen
    except ImportError:
            from urllib2 import urlopen

    result = urlopen(url)
    response = json.loads(result.read().decode("utf-8"))
    code = response['result']
    if code != 0:
        return "error"
    content = response['content'].replace('{br}','\n')
    return content


# 自动回复
# 封装好的装饰器，当接收到的消息是Text，即文字消息
@itchat.msg_register('Text')
def text_reply(msg):
    global BASEMSG
    global AUTO_REPLAY
    # 当消息不是由自己发出的时候
    #return  u"[主人暂时不在，我是周小秘]{}".format(tulin_robot(msg['Text']))
    #return  u"[主人暂时不在，我是周小秘]{}".format(robot(msg['Text']))

    if msg['Text'].lower() == "open":
        AUTO_REPLAY=1
        return "自动聊天功能已打开."
    elif msg['Text'].lower() == "close":
        AUTO_REPLAY=0
        return "自动聊天功能已关闭."
    elif msg['Text'].lower() == "add":
        BASEMSG = "[主人暂时不在，我是周小秘 ]:"
        return "添加附加内容成功"
    elif msg['Text'].lower() == "del":
        BASEMSG = ""
        AUTO_REPLAY=0
        return "取消附加内容成功"

    # 回复给好友
    if AUTO_REPLAY > 0 :
        if BASEMSG != "":
            return BASEMSG + qingke_robot(msg['Text'])
        return qingke_robot(msg['Text'])

if __name__ == '__main__':
    itchat.auto_login(enableCmdQR=2)

    # 获取自己的UserName
    myUserName = itchat.get_friends(update=True)[0]["UserName"]
    itchat.run(debug=True)
    #print(qingke_robot("你好"))

```
